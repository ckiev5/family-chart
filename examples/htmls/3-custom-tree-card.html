
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>3-custom-tree-card</title>
  <link rel="shortcut icon" type="image/svg" href="/examples/logo.svg">
  <script src="https://unpkg.com/d3@7"></script>
  <link rel="stylesheet" href="/src/styles/family-chart.css">
  <style> body { font-family: 'Arial', sans-serif; } </style>
</head>
<body>
<div id="FamilyChart" class="f3" style="width:100%;height:900px;margin:auto;background-color:rgb(33,33,33);color:#fff;"></div>
<script type="module">
import f3 from '../../src/index.js'

// list of all example. delete this if not needed
import sidebar from '../sidebar.js'
sidebar()

fetch('../data/data.json')
  .then(res => res.json())
  .then(data => create(data))
  .catch(err => console.error(err))

function create(data) {
  const cont = document.querySelector("#FamilyChart")
  const svg = f3.createSvg(cont)

  let tree_data = null;
  let main_id = null;

  update()

  function update() {
    tree_data = f3.calculateTree(data, {
      node_separation: 250,
      level_separation: 150,
      main_id
    })
    updateSvgHeading(svg, tree_data.data[0].data)
    f3.view(tree_data, svg, Card(onCardClick))
  }

  function onCardClick(d) {
    const node = this
    console.log(d)
    main_id = d.data.id;
    update()
  }

  function Card(onClick) {
    const card_dim = {w: 220, h: 70}

    return function (d) {
      this.innerHTML = ''
      const g = d3.select(this).append('g')
        .attr('transform', `translate(${[-card_dim.w / 2, -card_dim.h / 2]})`)
        .attr('class', 'card').attr('data-id', d.data.id)
        .attr('cursor', 'pointer').on('click', () => onClick.call(this, d))

      createRect()
      createText()

      function createRect() {
        g.append('rect').attr('width', card_dim.w).attr('height', card_dim.h).attr('rx', 3).attr('ry', 3)
          .attr('fill', d.data.data.gender === 'M' ? 'lightblue' : d.data.data.gender === 'F' ? 'pink' : 'lightgray')
          .attr('stroke', '#000').attr('stroke-width', d.data.main ? 2 : 0)
      }

      function createText() {
        g.append('text').attr('transform', `translate(${[20, 70/2+5]})`)
          .text(`${d.data.data['first name']} ${d.data.data['last name']}`)
      }
    }
  }

  function updateSvgHeading(svg, main_datum) {
    let svg_heading = d3.select(svg).select('.svg-heading')
    if (!svg_heading.node()) svg_heading = d3.select(svg).append('text').attr('class', 'svg-heading').attr('transform', `translate(${[10, 22]})`).style('fill', '#fff')
    svg_heading.text(`${main_datum.data['first name']} ${main_datum.data['last name']}`)
  }
}

</script>

</body>
</html>
